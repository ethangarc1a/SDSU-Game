<!doctype html>
<html lang="en" data-mode="sober">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SDSU Edition ‚Äî Party & Sober Modes</title>
  <meta name="description" content="A lightweight web game with Sober and 21+ Party modes, plus an engineering resume." />
  <meta name="theme-color" content="#b60202" />
  <link rel="manifest" href="./site.webmanifest" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 100 100%27%3E%3Crect width=%27100%27 height=%27100%27 rx=%2718%27 ry=%2718%27 fill=%27%23b60202%27/%3E%3Ctext y=%2780%27 x=%2722%27 font-size=%2780%27 fill=%27white%27%3Eüéì%3C/text%3E%3C/svg%3E">
  <link rel="stylesheet" href="./styles.css?v=3" />
  <script defer src="./deck.js"></script>
  <script defer src="./app.js"></script>
</head>
<body>
  <header class="site-header">
    <h1 class="brand">SDSU Game</h1>
    <nav class="nav">
      <a href="./resume.html" class="nav-link">Resume</a>
      <a href="#" id="deckLink" class="nav-link">Deck</a>
      <a href="#" id="howToLink" class="nav-link">How to Play</a>
      <a href="#" id="optionsLink" class="nav-link">Options</a>
      <a href="#" id="shareLink" class="nav-link">Share</a>
      <a href="#" id="themeToggle" class="nav-link" title="Toggle theme">Theme</a>
      <a href="#" id="installBtn" class="nav-link" style="display:none;">Install App</a>
      <a href="https://github.com" target="_blank" rel="noopener" class="nav-link">GitHub</a>
    </nav>
  </header>

  <main class="container" role="main">
    <section class="hero">
      <p class="kicker">No installs ‚Ä¢ Vanilla JS ‚Ä¢ Mobile-first ‚Ä¢ Now works offline</p>
      <h2>San Diego State Edition ‚Äî Play in Sober or 21+ Party Mode</h2>
      <p class="muted">
        Use ‚ÄúNew Game / Round‚Äù to start; ‚ÄúNext‚Äù draws the next card. Options, Deck Manager, sound/haptics, and shareable links included.
      </p>
    </section>

    <section class="panel">
      <div class="row between center">
        <h3 class="section-title">Mode</h3>
        <div class="segmented" role="group" aria-label="Game mode">
          <button class="seg-btn is-active" data-mode="sober" aria-pressed="true">Sober / All-ages</button>
          <button class="seg-btn" data-mode="party" aria-pressed="false">21+ Party</button>
        </div>
      </div>
      <p class="tiny muted" id="modeNote">
        Sober Mode swaps alcohol actions for points, water sips, or mini-challenges. Please play responsibly.
      </p>
    </section>

    <!-- GAME -->
    <section class="panel">
      <h3 class="section-title">Game</h3>

      <!-- HUD -->
      <div class="hud row between center">
        <div class="tiny muted">Round Timer: <strong id="timer">--:--</strong></div>
        <div class="tiny muted">Round: <strong id="roundLabel">1</strong></div>
        <div class="tiny muted crowd-wrap">
          Crowd: <strong id="crowdVal">0/10</strong>
          <progress id="crowdBar" max="10" value="0" aria-label="Crowd meter"></progress>
          <button id="crowdPlus" class="btn tinybtn" title="Crowd +1">+1</button>
          <button id="crowdMinus" class="btn tinybtn" title="Crowd -1">-1</button>
        </div>
      </div>

      <div class="game">
        <div id="card" class="card" aria-live="polite">
          <div class="card-title">Not started</div>
          <p class="card-body muted">Press <em>New Game / Round</em> to initialize the engine.</p>
        </div>

        <div class="controls">
          <button id="startBtn" class="btn primary">New Game / Round</button>
          <button id="nextBtn" class="btn" disabled>Next</button>

          <div class="row">
            <span class="tiny muted">Use Skip:</span>
            <select id="skipSelect" class="input"></select>
            <button id="useSkipBtn" class="btn">Use</button>
            <span id="skipArmedNote" class="tiny muted" aria-live="polite"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- SCOREBOARD -->
    <section class="panel">
      <h3 class="section-title">Scoreboard</h3>
      <div id="players" class="players"></div>
      <div class="row">
        <input id="newPlayerName" class="input" placeholder="Add player name" />
        <button id="addPlayerBtn" class="btn">Add</button>
        <button id="resetScoresBtn" class="btn">Reset Scores</button>
      </div>
    </section>

    <!-- Flavor preview (static) -->
    <section class="panel">
      <h3 class="section-title">SDSU-flavored rule preview</h3>
      <ul class="rules">
        <li><strong>Hepner Bell</strong> ‚Äî timed chime rounds every few minutes.</li>
        <li><strong>Trolley Tokens</strong> ‚Äî transit cards that skip/stack challenges.</li>
        <li><strong>The Show</strong> ‚Äî call-and-response hype cards.</li>
        <li><strong>Kawhi Bounce</strong> ‚Äî coin ‚Äútrick-shot‚Äù skill challenge.</li>
        <li><strong>Viejas Arena</strong> ‚Äî home/away team prompts, crowd meter.</li>
        <li><strong>Aztec History</strong> ‚Äî campus-history trivia & safe dares.</li>
        <li><strong>Sunset Cliffs</strong> ‚Äî risk/reward choices.</li>
      </ul>
      <p class="tiny muted">‚ÄúParty Mode‚Äù is for 21+ only. Don‚Äôt drink and drive.</p>
    </section>
  </main>

  <footer class="site-footer">
    <p class="tiny muted">¬© <span id="year"></span> Your Name. Educational demo. San Diego State University marks may be trademarks of their owners.</p>
  </footer>

  <!-- Age Gate -->
  <dialog id="ageGate" aria-label="Age verification">
    <form method="dialog" class="dialog-card">
      <h3>Are you 21 or older?</h3>
      <p class="muted">Party Mode is for 21+ players only. Sober Mode is available for everyone.</p>
      <div class="dialog-actions">
        <button value="no" class="btn">No, keep Sober Mode</button>
        <button value="yes" class="btn primary">Yes, I am 21+</button>
      </div>
    </form>
  </dialog>

  <!-- Setup dialog -->
  <dialog id="setupDlg" aria-label="New game setup">
    <form method="dialog" class="dialog-card">
      <h3>New Game Setup</h3>

      <label class="tiny">Players (comma-separated)</label>
      <input type="text" id="playersInput" class="input" value="You, Friend" />

      <div class="row">
        <div style="flex:1">
          <label class="tiny">Win points</label>
          <input type="number" id="winPointsInput" class="input" min="5" max="50" />
        </div>
        <div style="flex:1">
          <label class="tiny">Round length (seconds)</label>
          <input type="number" id="roundSecondsInput" class="input" min="30" max="600" />
        </div>
      </div>

      <p class="tiny muted">Hepner Bell interrupts automatically every few minutes.</p>

      <div class="dialog-actions">
        <button value="cancel" class="btn">Cancel</button>
        <button value="begin" class="btn primary">Begin</button>
      </div>
    </form>
  </dialog>

  <!-- How to Play dialog -->
  <dialog id="howToDlg" aria-label="How to Play">
    <form method="dialog" class="dialog-card">
      <h3>How to Play ‚Äî SDSU Edition</h3>
      <p class="tiny muted">Two modes: <strong>Sober / All-ages</strong> and <strong>21+ Party</strong> (age gate enforced). Same cards, different actions.</p>

      <ul class="rules" style="margin-left:18px">
        <li><strong>Goal:</strong> First to <em>Win points</em> (default 10) or play by rounds.</li>
        <li><strong>Loop:</strong> Draw a card ‚Üí follow the prompt ‚Üí award/adjust points ‚Üí Next.</li>
        <li><strong>Crowd Meter:</strong> Hype actions raise Crowd. At max, a <em>Storm the Court</em> card triggers; meter resets to 3.</li>
        <li><strong>Hepner Bell:</strong> Every few minutes, a bell interrupt shows a global mini-action.</li>
        <li><strong>Trolley Tokens:</strong> Cards may grant <em>Skip</em> or <em>Boost</em>. Skip arms the next card to be skipped; Boost adds +2 the next time that player gains points.</li>
      </ul>

      <h4>Keyboard shortcuts</h4>
      <ul class="rules" style="margin-left:18px">
        <li><kbd>N</kbd> ‚Äî Next card</li>
        <li><kbd>S</kbd> ‚Äî New Game / Round (opens setup)</li>
        <li><kbd>[</kbd>/<kbd>]</kbd> ‚Äî Crowd ‚àí1 / +1</li>
        <li><kbd>1‚Ä¶9</kbd> ‚Äî +1 to player #1‚Äì#9 (hold <kbd>‚å• Option</kbd> for ‚àí1)</li>
        <li><kbd>Esc</kbd> ‚Äî Close an open dialog</li>
      </ul>

      <p class="tiny muted">Play responsibly. Party Mode is for 21+ only. Hydrate, never drink and drive.</p>

      <div class="dialog-actions">
        <button value="ok" class="btn primary">Got it</button>
      </div>
    </form>
  </dialog>

  <!-- Options dialog -->
  <dialog id="optionsDlg" aria-label="Options">
    <form method="dialog" class="dialog-card">
      <h3>Options</h3>

      <label class="tiny">
        <input type="checkbox" id="optKeyboard" checked />
        Enable keyboard shortcuts
      </label>

      <div class="row" style="margin-top:8px">
        <div style="flex:1">
          <label class="tiny">Hepner Bell interval (seconds)</label>
          <input type="number" id="optBell" class="input" min="10" max="600" />
        </div>
        <div style="flex:1">
          <label class="tiny">Crowd max (trigger)</label>
          <input type="number" id="optCrowdMax" class="input" min="5" max="20" />
        </div>
        <div style="flex:1">
          <label class="tiny">Crowd reset after Storm</label>
          <input type="number" id="optCrowdReset" class="input" min="0" max="10" />
        </div>
      </div>

      <h4>Audio & Haptics</h4>
      <label class="tiny"><input type="checkbox" id="optSound" /> Enable sound effects (requires a click)</label><br/>
      <label class="tiny"><input type="checkbox" id="optHaptics" /> Enable haptics (mobile vibration)</label>
      <div class="row" style="margin-top:6px">
        <button id="testChimeBtn" class="btn">Test Hepner Bell</button>
      </div>

      <p class="tiny muted">Round length & win points are set in the ‚ÄúNew Game / Round‚Äù setup dialog.</p>

      <div class="dialog-actions">
        <button value="cancel" class="btn">Cancel</button>
        <button value="save" class="btn primary">Save</button>
      </div>
    </form>
  </dialog>

  <!-- First-run Welcome dialog -->
  <dialog id="onboardDlg" aria-label="Welcome">
    <form method="dialog" class="dialog-card">
      <h3>Welcome! üëã</h3>
      <p class="muted tiny">
        Start with <strong>New Game / Round</strong>. Use <kbd>N</kbd> for Next, <kbd>S</kbd> for setup, and <kbd>[</kbd>/<kbd>]</kbd> for Crowd.  
        Open <strong>How to Play</strong> any time from the header.
      </p>
      <div class="dialog-actions">
        <button value="ok" class="btn primary">Let‚Äôs play</button>
      </div>
    </form>
  </dialog>

  <!-- Deck Manager dialog -->
  <dialog id="deckDlg" aria-label="Deck Manager">
    <form method="dialog" class="dialog-card">
      <h3>Deck Manager</h3>
      <p class="tiny muted">Enable/disable categories, add custom cards, or import/export. Changes affect the <em>next</em> round you start.</p>

      <div class="section">
        <h4>Enabled Categories <span id="deckStatsLabel" class="tiny muted"></span></h4>
        <div id="catList" class="cats"></div>
      </div>

      <div class="section">
        <h4>Add a Custom Card</h4>
        <div class="grid2">
          <label>Category <input id="cardCat" class="input" placeholder="e.g., Sunset Cliffs" /></label>
          <label>Title <input id="cardTitle" class="input" placeholder="Card title" /></label>
        </div>
        <label>Prompt / Text <textarea id="cardText" class="input" rows="2" placeholder="Describe the prompt players will see"></textarea></label>
        <div class="grid2">
          <label>Sober action <input id="cardSober" class="input" placeholder="What happens in Sober mode?" /></label>
          <label>Party action <input id="cardParty" class="input" placeholder="What happens in 21+ Party mode?" /></label>
        </div>
        <div class="grid2">
          <label>Crowd delta <input id="cardCrowdDelta" type="number" class="input" value="0" /></label>
          <label>Token
            <select id="cardToken" class="input">
              <option value="">(none)</option>
              <option value="skip">Skip</option>
              <option value="boost">Boost</option>
            </select>
          </label>
        </div>
        <div class="row">
          <button id="addCustomBtn" class="btn">Add Card</button>
          <span id="addCustomNote" class="tiny muted" aria-live="polite"></span>
        </div>
      </div>

      <div class="section">
        <h4>Import / Export</h4>
        <div class="row">
          <button id="exportCustomBtn" class="btn">Export Custom (prefs + cards)</button>
          <button id="exportMergedBtn" class="btn">Export Merged Deck</button>
          <button id="showImportBtn" class="btn">Import‚Ä¶</button>
          <button id="resetDeckBtn" class="btn">Reset to Defaults</button>
        </div>
        <div id="importWrap" class="import hidden">
          <textarea id="importText" class="input" rows="6" placeholder='Paste JSON: either {"customCards":[],"enabledCategories":{}} or {"cards":[...]}'></textarea>
          <div class="row">
            <button id="applyImportBtn" class="btn primary">Apply Import</button>
            <button id="cancelImportBtn" class="btn">Cancel</button>
          </div>
        </div>
      </div>

      <div class="dialog-actions">
        <button value="close" class="btn primary">Done</button>
      </div>
    </form>
  </dialog>
</body>
</html>

